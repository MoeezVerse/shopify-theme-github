<div class="collection-cart" style="
    z-index: 9999999;
    position: relative;">
  {% for variant in product.variants %}
    <input type="hidden" id="varaintgetid" value="{{ variant.id }}">
  {% endfor %}
  <button onclick="" type="button" name="add" id="collection-cart-{{ product.id }}" >Add To cart</button>
</div>

<script>
//   function addToCart() {
//    let addCart = document.querySelectorAll('.collection-cart button');
//     alert("ok");
// }

$(document).on('click', '#collection-cart-{{ product.id }}', function () {
    let getvarintid = $(this).parents('.collection-cart').find('#varaintgetid').val();
    alert(getvarintid);

    let formobj = {
        quantity: 1,
        id: getvarintid
    };

    // Add product to cart
    $.ajax({
        type: "POST",
        url: "/cart/add.js",
        cache: false,
        data: formobj,
        dataType: "json",
        success: function (data) {
            console.log('Product added to cart:', data);

            // Fetch the updated cart data
            updateCart();
        },
        error: function (xhr, ajaxOption, thrownError) {
            console.log('Error adding product to cart:', thrownError);
        }
    });
   this.onCartUpdate();
});

// Function to fetch updated cart data
function updateCart() {
    $.ajax({
        type: "GET",
        url: "/cart.js",
        dataType: "json",
        success: function (cartData) {
            console.log('Updated cart data:', cartData);

            // Update the cart count dynamically
            $('#cart-count').text(cartData.item_count);

            // Optional: Update the cart preview or other cart elements dynamically
            updateCartPreview(cartData);
        },
        error: function (xhr, ajaxOption, thrownError) {
            console.log('Error fetching updated cart:', thrownError);
        }
    });
}

// Optional: Function to update cart preview (if applicable)
function updateCartPreview(cartData) {
    let cartItemsHtml = '';
    cartData.items.forEach(function (item) {
        cartItemsHtml += `
            <li>${item.quantity} x ${item.title}</li>
        `;
    });
    $('#cart-preview').html(cartItemsHtml); // Update your cart preview container
}


  
</script>